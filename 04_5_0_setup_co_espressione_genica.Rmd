---
title: "Fase 4.5.0: Setup analisi di co-espressione genica"
author: "Giacomo Pensiero"
date: "2025-12-05"
output: html_document
---

In questo script viene eseguito il preprocessing dell’oggetto *bone_multi*  per l’analisi di co-espressione genica. In particolare, l’oggetto viene aggiornato alla versione corrente di Seurat, viene impostato l’assay “RNA” come predefinito e vengono rimossi geni predetti/non annotati (pattern “Gm*” e “*Rik”). Successivamente, i dati vengono normalizzati e vengono calcolate le *feature altamente variabili* e lo *scaling*, producendo un oggetto preprocessato utilizzato come input per l’analisi di co-espressione nei cluster di interesse.

```{r setup, include=TRUE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r librerie, eval=TRUE, echo=TRUE, warning=FALSE, message=FALSE}
library(Seurat)
library(hdWGCNA)
library(WGCNA)
set.seed(1234)
```

```{r libreria, eval=TRUE, echo=TRUE, warning=FALSE, message=FALSE}
base_path <- "C:/Users/giaco/OneDrive/Desktop/TBX1/Analisi_Giacomo"
hdwgcna_path <- file.path(base_path, "intermediate/hdwgcna/preprocessing")
bone_multi_path <- file.path(base_path, "intermediate/clustering")
results_hdwgcna <- file.path(base_path, "results/hdwgcna")
bone_multi <- readRDS(file.path(bone_multi_path, "bone_multi_postclustering.rds"))
```

```{r pre, eval=TRUE, echo=TRUE, warning=FALSE, message=FALSE}
bone_multi <- SeuratObject::UpdateSeuratObject(bone_multi)
DefaultAssay(bone_multi) <- "RNA"

gm_rik_genes <- rownames(bone_multi)[
  grepl("^Gm",  rownames(bone_multi), ignore.case = TRUE) |
    grepl("Rik$", rownames(bone_multi), ignore.case = TRUE)
]
keep_genes <- setdiff(rownames(bone_multi), gm_rik_genes)
bone_multi <- subset(bone_multi, features = keep_genes)
bone_multi <- NormalizeData(bone_multi)
bone_multi <- FindVariableFeatures(bone_multi, selection.method = "vst", nfeatures = 2000)
bone_multi <- ScaleData(bone_multi, features = VariableFeatures(bone_multi))
```

Al termine del preprocessing, l’oggetto *bone_multi* è stato salvato in formato *RDS* come `bone_multi_preprocessed.rds` ed è utilizzato come input per gli script di analisi di co-espressione genica per i diversi cluster.

```{r salvataggio, echo=TRUE, eval=TRUE, warning=FALSE, message=FALSE}
saveRDS(bone_multi, file.path(hdwgcna_path, "bone_multi_preprocessed.rds"))
```

```{r session-info, echo=TRUE}
sessionInfo()
```





